<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Schools</title>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="icon" href="favicon.ico" />
    <link
      href="https://fonts.googleapis.com/css?family=Merriweather&display=swap"
      rel="stylesheet"
    />
  </head>

  <body onload="addKommun()">
    <!--
Comments are written as HTML style.
-->

    <header>
      <nav>
        <a href="me.html">Me</a>
        <a href="report.html">Report</a>
        <a href="about.html">About</a>
        <a href="schools.html">Schools in Sweden</a>
      </nav>
    </header>

    <article>
      <form style="margin-top: 200px" action="">
        <select
          id="kommunForm"
          name="Kommun()"
          onchange="showSchools(this.value)"
        >
        </select>
      </form>
      <h2>Select municipality to show the schools in it</h2>
      <table id="demo"></table>
      <p id ="demo2"></p>

      <script>
        function addKommun() {
          //ProxyUrl used to avoid CORS
          const proxyUrl = "https://cors-anywhere.herokuapp.com/";
          const url =
            "https://api.scb.se/UF0109/v2/skolenhetsregister/sv/kommun";
          var xmlhttp = new XMLHttpRequest();
          xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
              var response = this.responseText;
              
              var json = JSON.parse(response);
              var jsonKommuner = json.Kommuner;
              var kommunCount = jsonKommuner.length;
              daySelect = document.getElementById("kommunForm");
              for (var i = 0; i < kommunCount; i++) {
                daySelect.options[i] = new Option(jsonKommuner[i].Namn + jsonKommuner[i].Kommunkod, jsonKommuner[i].Kommunkod);
              }
            }
          };
          xmlhttp.open("GET", proxyUrl + url, true);
          xmlhttp.send();
        }

        function showSchools(KommunkodValue) {
          //ProxyUrl used to avoid CORS
          const proxyUrl = "https://cors-anywhere.herokuapp.com/";
          const url =
            "https://api.scb.se/UF0109/v2/skolenhetsregister/sv/kommun/" +
            KommunkodValue;

          var xmlhttp = new XMLHttpRequest();
          xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
              var response = this.responseText;
              var json = JSON.parse(response);
              var jsonSchool = json.Skolenheter;
              var schoolCount = jsonSchool.length;
              var table =
                "<tr><th>Kommunkod</th><th>PeOrgNr</th><th>Skolenhetskod</th><th>Skolenhetsnamn</th></tr>";
              var i;
              for (i = 0; i < schoolCount; i++) {
                table +=
                  "<tr><td>" +
                  jsonSchool[i].Kommunkod +
                  "</td><td>" +
                  jsonSchool[i].PeOrgNr +
                  "</td><td>" +
                  jsonSchool[i].Skolenhetskod +
                  "</td><td>" +
                  jsonSchool[i].Skolenhetsnamn;
                ("</td></tr>");
              }

              document.getElementById("demo").innerHTML = table;
            }
          };
          xmlhttp.open("GET", proxyUrl + url, true);
          xmlhttp.send();
        }
      </script>
    </article>

    <footer>
      <hr />
      <h6>
        Elias Haloun e-mail: elias.haloun0104@stud.hkr.se phone: +46xxxxxxxx
      </h6>
    </footer>

    <script type="text/javascript" src="js/main.js"></script>
  </body>
</html>
